---
- name: close incidents from list
  servicenow.itsm.incident:
    state: closed
    number: "{{ item }}"
    close_code: "Solved (Permanently)"
    close_notes: "Closed with ansible servicenow.itsm"
  with_items: "{{ incident_list }}"
  when: 
    - incident_list is defined

- name: close problems from list
  servicenow.itsm.problem:
    problem_mapping: 
      state:
        1: "Open"
        2: "Known Error"
        3: "Pending Change"
        4: "Closed/Resolved"
        5: "closed"
    state: "closed"
    resolution_code: "fix_applied"
    fix_notes: "Closed with ansible servicenow.itsm" 
    assigned_to: "{{ username }}"
    number: "{{ item }}"
  with_items: "{{ problem_list }}"
  when: 
    - problem_list is defined
  
- name: close user created change requests
  servicenow.itsm.change_request:
    state: "closed"
    close_code: "successful"
    close_notes: "Closed with ansible servicenow.itsm"
    number: "{{ item }}"
  with_items: "{{ change_list }}"
  when: 
    - change_list is defined

